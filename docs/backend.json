{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the StyleAI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        }
      },
      "required": [
        "id",
        "email",
        "username"
      ]
    },
    "ClothingItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClothingItem",
      "type": "object",
      "description": "Represents a clothing item uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ClothingItem entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ClothingItem)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image of the clothing item.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the clothing item (e.g., shirt, pants, dress)."
        },
        "description": {
          "type": "string",
          "description": "A user-provided description of the item."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "imageUrl",
        "category"
      ]
    },
    "OutfitSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OutfitSuggestion",
      "type": "object",
      "description": "Represents an outfit suggestion generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OutfitSuggestion entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N OutfitSuggestion)"
        },
        "clothingItemIds": {
          "type": "array",
          "description": "References to ClothingItems that make up the suggestion. (Relationship: ClothingItem N:N OutfitSuggestion)",
          "items": {
            "type": "string"
          }
        },
        "occasion": {
          "type": "string",
          "description": "The occasion for which the outfit is suggested."
        },
        "description": {
          "type": "string",
          "description": "Description of the outfit suggestion provided by the AI."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "clothingItemIds"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The 'userProfileId' is equal to the Firebase Auth UID.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/clothingItems/{clothingItemId}",
        "definition": {
          "entityName": "ClothingItem",
          "schema": {
            "$ref": "#/backend/entities/ClothingItem"
          },
          "description": "Stores clothing items uploaded by a user.  Access is restricted to the owning user.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The Firebase Auth UID of the user who owns the clothing item."
            },
            {
              "name": "clothingItemId",
              "description": "The unique ID of the clothing item."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/outfitSuggestions/{outfitSuggestionId}",
        "definition": {
          "entityName": "OutfitSuggestion",
          "schema": {
            "$ref": "#/backend/entities/OutfitSuggestion"
          },
          "description": "Stores outfit suggestions generated by the AI for a user. Access is restricted to the owning user.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The Firebase Auth UID of the user who owns the outfit suggestion."
            },
            {
              "name": "outfitSuggestionId",
              "description": "The unique ID of the outfit suggestion."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure and scalable solution for the StyleAI application, focusing on user-owned data with clear authorization boundaries. It avoids hierarchical authorization dependencies by structuring data in a way that security rules can be applied independently at each level, enabling atomic operations and simplifying debugging.\n\n1.  **User Profiles:** Stored in a `userProfiles` collection, this data is generally public but could contain private subcollections in the future such as `settings`. User profiles are created upon authentication.\n\n2.  **Clothing Items:** Clothing items are stored within a subcollection of the user's profile (`/userProfiles/{userProfileId}/clothingItems/{clothingItemId}`). This enforces clear ownership and simplifies security rules, as access control is directly tied to the user's ID. This structure supports the `Image Upload` and `Wardrobe Display` features.  List operations (`get` operations) are also secured in this way.\n\n3.  **Outfit Suggestions:** Similar to Clothing Items, outfit suggestions are stored as subcollections of the user's profile (`/userProfiles/{userProfileId}/outfitSuggestions/{outfitSuggestionId}`). This structure maintains clear ownership and simplifies security rules. This approach enables the `AI Styling Assistant` feature by associating suggestions directly with user profiles. List operations (`get` operations) are also secured in this way.\n\nThis structure achieves Authorization Independence by avoiding `get()` calls in security rules. Security rules are based on the path (user ID) and the data within each document.  The structure supports the required QAPs (Rules are not Filters) by using path-based ownership and collection segregation. Each collection has a homogeneous security posture, ensuring that list operations are secure and efficient. The design leverages path-based ownership which is the most secure and efficient way to manage User 1:N relationships."
  }
}